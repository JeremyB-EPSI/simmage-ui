sudo: required
dist: trusty
language: node_js
node_js:
- node
addons:
  ssh_known_hosts: maya.elol.fr
apt:
  sources:
  - google-chrome
  packages:
  - google-chrome-stable
  - google-chrome-beta
before_install:
- openssl aes-256-cbc -K $encrypted_b52bebe2eeaf_key -iv $encrypted_b52bebe2eeaf_iv
  -in deploy/deploy_rsa.enc -out deploy/deploy_rsa -d
- export CHROME_BIN=chromium-browser
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
before_script:
- npm install -g angular-cli
- npm install -g karma
- npm install
- ng build -prod
script: karma start config/karma.conf.js --single-run

before_deploy:
- eval "$(ssh-agent -s)"
- chmod 600 $TRAVIS_BUILD_DIR/deploy/deploy_rsa
- ssh-add $TRAVIS_BUILD_DIR/deploy/deploy_rsa
deploy:
  provider: script
  skip_cleanup: true
  script: rsync -delete dist/ "deploy@maya.elol.fr:www/deploymecs/root/htdocs" 
  on:
    branch: master
    php: 5.6
